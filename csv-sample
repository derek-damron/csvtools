#! /bin/bash

DELIM=','
while getopts h?d:f:p: OPT; do
    case $OPT in
        \?|h)
            echo "csv-sample: Randomly sample a proportion of a data set."
            echo "useage:"
            echo "  csv-sample -f <delimited file> [-d <delim>] -p <proportion>"
            exit 0
            ;;
        d)
            DELIM=$OPTARG
            ;;
        f)
            FILE=$OPTARG
            ;;
        p)
            PROP=$OPTARG
            ;;
    esac
done

NREC=$(cat $FILE | tail -n +2 | wc -l)
NTOTAKE=$(echo "$NREC * $PROP" | bc -l | cut -d. -f1)

{ cat $FILE | head -1 ; \
  cat $FILE | tail -n +2 | shuf -n $NTOTAKE ; \
}
